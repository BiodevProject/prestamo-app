<html xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/layout :: layout(~{::content}, '/css/userDashboard.css')"
      th:with="title='Facturas'">
  <div th:fragment="content">

    <!-- Page Content -->
    <div class="page-container" style="margin-top: 100px;">
      <h1 class="header">Facturas</h1>

      <nav class="breadcrumb" aria-label="breadcrumb">
        <a href="/">Inicio</a> ›
        <span class="current">Facturas</span>
      </nav>

      <!-- Search and Add User Row -->
      <div class="user-controls">
        <div class="search-container">
          <input type="text" id="userSearch" placeholder="Buscar facturas..." class="search-input">
          <button type="button" class="search-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
          </button>
        </div>
        <a class="btn btn-primary" href="/factura/form">Crear nueva factura</a>
      </div>

      <!-- User Cards -->
      <div class="users-container" id="usersContainer">
        <div class="user-card" th:each="factura : ${facturas}" th:data-search="${factura.id + ' ' + factura.buyer + ' ' + factura.seller + ' ' + factura.product}">
          <div class="user-info">
            <img src="/defaultPfp.png" class="avatar" alt="Avatar" />

            <div class="user-details-container">
              <div class="username-row">
                <h2 class="username" th:text="${factura.id}">Id</h2>
              </div>

              <div class="user-details">
                <p class="user-info-element">
                  <span class="label">Fecha de emision</span>
                  <span th:text="${factura.date}">email@example.com</span>
                </p>
                <p class="user-info-element">
                  <span class="label">Comprador:</span>
                  <span th:text="${factura.buyer}">000000000</span>
                </p>
                <p class="user-info-element">
                  <span class="label">Vendedor:</span>
                  <span th:text="${factura.seller}">000000000</span>
                </p>
                <p class="user-info-element">
                  <span class="label">Producto:</span>
                  <span th:text="${factura.product}">000000000</span>
                </p>
                <p class="user-info-element">
                  <span class="label">Precio:</span>
                  <span th:text="${factura.price} + '$'"></span>
                </p>
              </div>

              <div class="user-actions">
                <form th:onsubmit="'event.preventDefault(); window.location.href=\'' + @{/factura/edit/{id}(id=${factura.id})} + '\';'">
                  <button type="submit" class="btn btn-outline-primary">Ver</button>
                </form>

                <form th:action="@{/factura/delete/{id}(id=${factura.id})}" method="post" onsubmit="return confirm('¿Eliminar factura?');">
                  <button type="submit" class="btn btn-outline-danger">Eliminar</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('userSearch');
        const userCards = document.querySelectorAll('.user-card');

        searchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();

          userCards.forEach(card => {
            const searchData = card.getAttribute('data-search').toLowerCase();
            if (searchData.includes(searchTerm)) {
              card.style.display = 'flex';
            } else {
              card.style.display = 'none';
            }
          });
        });
      });
    </script>

  </div>
</html>